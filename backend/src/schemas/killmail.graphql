type KillmailEdge {
  node: Killmail!
  cursor: String!
}

type KillmailConnection {
  edges: [KillmailEdge!]!
  pageInfo: PageInfo!
}

input SyncMyKillmailsInput {
  clientMutationId: String
}

type SyncMyKillmailsPayload {
  success: Boolean!
  message: String!
  syncedCount: Int!
  clientMutationId: String
}

type Killmail {
  id: ID!
  killmailId: Int!
  killmailHash: String!
  killmailTime: String!
  solarSystemId: Int!
  solarSystem: SolarSystem
  victim: Victim!
  attackers: [Attacker!]!
  items: [KillmailItem!]!
  totalValue: Float
  createdAt: String!
}

type Victim {
  characterId: Int
  characterName: String
  character: Character
  corporationId: Int!
  corporationName: String
  corporation: Corporation
  allianceId: Int
  allianceName: String
  alliance: Alliance
  factionId: Int
  shipTypeId: Int!
  shipTypeName: String
  shipType: Type
  damageTaken: Int!
  position: Position
}

type Position {
  x: Float!
  y: Float!
  z: Float!
}

type Attacker {
  characterId: Int
  characterName: String
  character: Character
  corporationId: Int
  corporationName: String
  corporation: Corporation
  allianceId: Int
  allianceName: String
  alliance: Alliance
  factionId: Int
  shipTypeId: Int
  shipTypeName: String
  shipType: Type
  weaponTypeId: Int
  weaponTypeName: String
  weaponType: Type
  damageDone: Int!
  finalBlow: Boolean!
  securityStatus: Float!
}

type KillmailItem {
  itemTypeId: Int!
  itemTypeName: String
  itemType: Type
  flag: Int!
  quantityDropped: Int
  quantityDestroyed: Int
  singleton: Int!
}

input KillmailFilter {
  page: Int
  limit: Int
  orderBy: KillmailOrderBy
  search: String
  regionId: Int
  systemId: Int
}

enum KillmailOrderBy {
  timeDesc
  timeAsc
}

extend type Query {
  """
  Fetches a single killmail
  """
  killmail(id: ID!): Killmail

  """
  Lists all killmails (with pagination using Relay-style connection)
  """
  killmails(filter: KillmailFilter): KillmailConnection!

  """
  Fetches killmails for a specific character
  """
  characterKillmails(
    characterId: Int!
    first: Int
    after: String
  ): KillmailConnection!

  """
  Fetches killmails for a specific corporation
  """
  corporationKillmails(
    corporationId: Int!
    first: Int
    after: String
  ): KillmailConnection!

  """
  Fetches killmails for a specific alliance
  """
  allianceKillmails(
    allianceId: Int!
    first: Int
    after: String
  ): KillmailConnection!

  """
  Fetches the authenticated user's own killmails
  Requires: Authentication
  """
  myKillmails(limit: Int): [Killmail!]!

  """
  Fetches the authenticated user's corporation killmails
  Requires: Authentication + esi-killmails.read_corporation_killmails.v1 scope
  """
  myCorporationKillmails(limit: Int): [Killmail!]!
}

extend type Mutation {
  """
  Fetches user's killmails from ESI and saves to database
  Requires: Authentication
  """
  syncMyKillmails(input: SyncMyKillmailsInput!): SyncMyKillmailsPayload!
}

extend type Subscription {
  """
  Subscribe to new killmails as they are added to the database
  Emits a new event whenever a killmail is saved
  """
  newKillmail: Killmail!
}
