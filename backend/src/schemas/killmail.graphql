type KillmailEdge {
  node: Killmail!
  cursor: String!
}

type KillmailConnection {
  edges: [KillmailEdge!]!
  pageInfo: PageInfo!
}

type KillmailDateCount {
  date: String!
  count: Int!
}

input SyncMyKillmailsInput {
  clientMutationId: String
}

type SyncMyKillmailsPayload {
  success: Boolean!
  message: String!
  syncedCount: Int!
  clientMutationId: String
}

type Killmail {
  id: ID!
  killmailHash: String!
  killmailTime: String!
  solarSystem: SolarSystem!
  victim: Victim
  attackers: [Attacker!]!
  attackerCount: Int!
  finalBlow: Attacker
  items: [KillmailItem!]!
  fitting: Fitting
  destroyedValue: Float
  droppedValue: Float
  totalValue: Float
  isSoloKill: Boolean!
  hasNpcAttackers: Boolean!
  createdAt: String!
}

type Victim {
  character: Character
  corporation: Corporation
  alliance: Alliance
  factionId: Int
  shipType: Type!
  damageTaken: Int!
  position: Position
}

type Position {
  x: Float!
  y: Float!
  z: Float!
}

type Attacker {
  character: Character
  corporation: Corporation
  alliance: Alliance
  factionId: Int
  shipType: Type
  weaponType: Type
  damageDone: Int!
  finalBlow: Boolean!
  securityStatus: Float
}

type KillmailItem {
  itemType: Type!
  flag: Int!
  quantityDropped: Int
  quantityDestroyed: Int
  singleton: Int!
  charge: KillmailItem
}

"""
Organized fitting data for a ship
Groups modules, rigs, and subsystems by their slot types
"""
type Fitting {
  highSlots: SlotGroup!
  midSlots: SlotGroup!
  lowSlots: SlotGroup!
  rigs: SlotGroup!
  subsystems: SlotGroup!
  serviceSlots: SlotGroup!
  implants: SlotGroup!
  cargo: [FittingModule!]!
  droneBay: [FittingModule!]!
  fighterBay: [FittingModule!]!
  structureFuel: [FittingModule!]!
  coreRoom: [FittingModule!]!
}

"""
A group of slots with total slot count from dogma attributes
"""
type SlotGroup {
  totalSlots: Int!
  slots: [FittingSlot!]!
}

"""
Represents a single slot (e.g., High Slot 0)
Contains the module fitted in that slot and its charge (if any)
"""
type FittingSlot {
  slotIndex: Int!
  module: FittingModule
}

"""
Represents a fitted module or item
"""
type FittingModule {
  itemType: Type!
  flag: Int!
  quantityDropped: Int
  quantityDestroyed: Int
  singleton: Int!
  charge: FittingModule
}

input KillmailFilter {
  page: Int
  limit: Int
  orderBy: KillmailOrderBy
  search: String
  shipTypeId: Int
  regionId: Int
  systemId: Int
  characterId: Int
  corporationId: Int
  allianceId: Int
}

enum KillmailOrderBy {
  timeDesc
  timeAsc
}

extend type Query {
  """
  Fetches a single killmail
  """
  killmail(id: ID!): Killmail

  """
  Lists all killmails (with pagination using Relay-style connection)
  """
  killmails(filter: KillmailFilter): KillmailConnection!

  """
  Returns count of killmails grouped by date (for the current filter)
  """
  killmailsDateCounts(filter: KillmailFilter): [KillmailDateCount!]!
}

extend type Mutation {
  """
  Fetches user's killmails from ESI and saves to database
  Requires: Authentication
  """
  syncMyKillmails(input: SyncMyKillmailsInput!): SyncMyKillmailsPayload!
}

extend type Subscription {
  """
  Subscribe to new killmails as they are added to the database
  Emits a new event whenever a killmail is saved
  """
  newKillmail: Killmail!
}
