# Query Optimization Deployment - Quick Checklist

## ðŸ“‹ Pre-Deployment

- [ ] Kod deÄŸiÅŸiklikleri review edildi
- [ ] Database backup alÄ±ndÄ±
- [ ] Deployment zamanÄ± belirlendi (sakin saatler tercih edilir)
- [ ] Rollback planÄ± hazÄ±r

---

## ðŸš€ Deployment Steps

### 1. Kod Deploy

```bash
cd /root/killreport
git pull origin main
cd backend
npm install
npm run build
```

**Status:** [ ] TamamlandÄ±

---

### 2. Database Migration

```bash
cd /root/killreport/backend
npx prisma migrate deploy
```

**Beklenen sÃ¼re:** 30-60 saniye
**Status:** [ ] TamamlandÄ±

---

### 3. Verify Materialized View

**Navicat SQL Console'da Ã§alÄ±ÅŸtÄ±r:**

```sql
-- View var mÄ±?
SELECT EXISTS (SELECT FROM pg_matviews WHERE matviewname = 'killmail_filters_mv') as exists;

-- KaÃ§ kayÄ±t var?
SELECT COUNT(*) as records FROM killmail_filters_mv;
```

**Beklenen:** `exists = t` (true), `records > 0`
**Status:** [ ] TamamlandÄ±

---

### 4. Backend Restart

```bash
pm2 restart backend
pm2 logs backend --lines 50
```

**Check for:** Error yok, "ðŸŽ¯ Using Materialized View" log var
**Status:** [ ] TamamlandÄ±

---

### 5. Test Alliance Query

```bash
curl -X POST https://api.killreport.com/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"query{killmails(filter:{allianceId:99000006,page:1,limit:25}){items{id}pageInfo{totalCount}}}"}'
```

**Beklenen:** 200 OK, data dÃ¶ndÃ¼, error yok
**Status:** [ ] TamamlandÄ±

---

## âœ… Post-Deployment Verification

### Immediate Checks (0-10 dakika sonra)

- [ ] Frontend killmail sayfasÄ± Ã§alÄ±ÅŸÄ±yor
- [ ] Alliance filtresi error vermiyor
- [ ] PM2 logs temiz (error yok)
- [ ] Response times < 2 saniye

### Short-term Checks (1-2 saat sonra)

- [ ] KullanÄ±cÄ± ÅŸikayeti yok
- [ ] Error rate normal
- [ ] Materialized view refresh Ã§alÄ±ÅŸÄ±yor (log kontrol)
- [ ] Cache hit rate iyi

### Long-term Checks (24 saat sonra)

- [ ] Performance metrics stabile
- [ ] Database disk kullanÄ±mÄ± normal
- [ ] Query patterns expected
- [ ] No memory leaks

---

## âš ï¸ Rollback Triggers

AÅŸaÄŸÄ±daki durumlardan biri oluÅŸursa ROLLBACK yap:

- [ ] Alliance queries hala error veriyor
- [ ] Response time > 5 saniye consistently
- [ ] Database CPU > 90% sÃ¼rekli
- [ ] Backend crash ediyor

**Rollback Command:**

```bash
cd /root/killreport
git checkout <previous-commit>
cd backend
npm run build
pm2 restart backend
```

---

## ðŸ“Š Success Metrics

| Metric                       | Before     | Target | Actual  |
| ---------------------------- | ---------- | ------ | ------- |
| Alliance Query Success Rate  | 0% (error) | 99%+   | \_\_\_% |
| Alliance Query Response Time | N/A        | <2s    | \_\_\_s |
| Parameter Limit Errors       | Many       | 0      | \_\_\_  |
| Overall Query Performance    | Slow       | Fast   | \_\_\_  |

---

## ðŸ“ Notes

**Deployment Date:** **\*\***\_\_\_**\*\***
**Deployed By:** **\*\***\_\_\_**\*\***
**Start Time:** **\*\***\_\_\_**\*\***
**End Time:** **\*\***\_\_\_**\*\***
**Issues Encountered:** **\*\***\_\_\_**\*\***
**Resolution:** **\*\***\_\_\_**\*\***

---

**Deployment Status:** [ ] SUCCESS [ ] FAILED [ ] ROLLED BACK
